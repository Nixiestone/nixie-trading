<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nixie Trades Journal</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- Storage Polyfill for GitHub Pages -->
    <script>
        // Simple localStorage-based storage for GitHub Pages
        window.storage = {
            get: async (key) => {
                try {
                    const value = localStorage.getItem(key);
                    return value ? { key, value } : null;
                } catch (error) {
                    return null;
                }
            },
            set: async (key, value) => {
                try {
                    localStorage.setItem(key, value);
                    return { key, value };
                } catch (error) {
                    return null;
                }
            },
            delete: async (key) => {
                try {
                    localStorage.removeItem(key);
                    return { key, deleted: true };
                } catch (error) {
                    return null;
                }
            }
        };
    </script>

    <!-- Trading Journal React Component -->
    <script type="text/babel">
        import React, { useState, useEffect } from 'react';
import { PlusCircle, TrendingUp, TrendingDown, DollarSign, BarChart3, Calendar, Clock, Edit2, Trash2, Download, Moon, Sun, User, Settings, LogOut, Home, BookOpen, PieChart, Activity } from 'lucide-react';

// Storage keys
const STORAGE_KEYS = {
  ACCOUNTS: 'nixie_accounts',
  ACTIVE_ACCOUNT: 'nixie_active_account',
  THEME: 'nixie_theme'
};

// Symbol configurations for proper calculation
const SYMBOL_CONFIGS = {
  // Forex Majors
  'EURUSD': { type: 'forex', pipValue: 0.0001, pipPosition: 4 },
  'GBPUSD': { type: 'forex', pipValue: 0.0001, pipPosition: 4 },
  'USDJPY': { type: 'forex', pipValue: 0.01, pipPosition: 2 },
  'USDCHF': { type: 'forex', pipValue: 0.0001, pipPosition: 4 },
  'AUDUSD': { type: 'forex', pipValue: 0.0001, pipPosition: 4 },
  'USDCAD': { type: 'forex', pipValue: 0.0001, pipPosition: 4 },
  'NZDUSD': { type: 'forex', pipValue: 0.0001, pipPosition: 4 },
  // Metals
  'XAUUSD': { type: 'metal', pipValue: 0.01, pipPosition: 2 },
  'XAGUSD': { type: 'metal', pipValue: 0.001, pipPosition: 3 },
  // Crypto
  'BTCUSD': { type: 'crypto', pipValue: 1, pipPosition: 0 },
  'ETHUSD': { type: 'crypto', pipValue: 0.01, pipPosition: 2 },
  // Indices
  'US30': { type: 'index', pipValue: 1, pipPosition: 0 },
  'US100': { type: 'index', pipValue: 1, pipPosition: 0 },
  'US500': { type: 'index', pipValue: 0.1, pipPosition: 1 }
};

const TradingJournal = () => {
  const [theme, setTheme] = useState('dark');
  const [accounts, setAccounts] = useState([]);
  const [activeAccountId, setActiveAccountId] = useState(null);
  const [currentView, setCurrentView] = useState('dashboard');
  const [showAddAccount, setShowAddAccount] = useState(false);
  
  // Load data on mount
  useEffect(() => {
    loadFromStorage();
  }, []);

  // Save to storage whenever data changes
  useEffect(() => {
    saveToStorage();
  }, [accounts, activeAccountId, theme]);

  const loadFromStorage = async () => {
    try {
      const savedTheme = await window.storage.get(STORAGE_KEYS.THEME);
      if (savedTheme?.value) setTheme(savedTheme.value);

      const savedAccounts = await window.storage.get(STORAGE_KEYS.ACCOUNTS);
      if (savedAccounts?.value) {
        const parsedAccounts = JSON.parse(savedAccounts.value);
        setAccounts(parsedAccounts);
        
        const savedActiveId = await window.storage.get(STORAGE_KEYS.ACTIVE_ACCOUNT);
        if (savedActiveId?.value) {
          setActiveAccountId(savedActiveId.value);
        } else if (parsedAccounts.length > 0) {
          setActiveAccountId(parsedAccounts[0].id);
        }
      }
    } catch (error) {
      console.log('No saved data found, starting fresh');
    }
  };

  const saveToStorage = async () => {
    try {
      await window.storage.set(STORAGE_KEYS.ACCOUNTS, JSON.stringify(accounts));
      await window.storage.set(STORAGE_KEYS.ACTIVE_ACCOUNT, activeAccountId);
      await window.storage.set(STORAGE_KEYS.THEME, theme);
    } catch (error) {
      console.error('Error saving to storage:', error);
    }
  };

  const activeAccount = accounts.find(acc => acc.id === activeAccountId);

  const toggleTheme = () => {
    setTheme(prev => prev === 'dark' ? 'light' : 'dark');
  };

  const addAccount = (name, balance, broker) => {
    const newAccount = {
      id: Date.now().toString(),
      name,
      initialBalance: parseFloat(balance),
      currentBalance: parseFloat(balance),
      broker,
      trades: [],
      createdAt: new Date().toISOString()
    };
    setAccounts([...accounts, newAccount]);
    setActiveAccountId(newAccount.id);
    setShowAddAccount(false);
  };

  const switchAccount = (accountId) => {
    setActiveAccountId(accountId);
    setCurrentView('dashboard');
  };

  const deleteAccount = (accountId) => {
    if (window.confirm('Are you sure you want to delete this account? This action cannot be undone.')) {
      const newAccounts = accounts.filter(acc => acc.id !== accountId);
      setAccounts(newAccounts);
      if (activeAccountId === accountId) {
        setActiveAccountId(newAccounts[0]?.id || null);
      }
    }
  };

  const addTrade = (tradeData) => {
    const updatedAccounts = accounts.map(acc => {
      if (acc.id === activeAccountId) {
        const newTrade = {
          ...tradeData,
          id: Date.now().toString()
        };
        return {
          ...acc,
          trades: [...acc.trades, newTrade],
          currentBalance: acc.currentBalance + parseFloat(tradeData.pl)
        };
      }
      return acc;
    });
    setAccounts(updatedAccounts);
    setCurrentView('history');
  };

  const updateTrade = (tradeId, updatedData) => {
    const updatedAccounts = accounts.map(acc => {
      if (acc.id === activeAccountId) {
        const oldTrade = acc.trades.find(t => t.id === tradeId);
        const balanceChange = parseFloat(updatedData.pl) - parseFloat(oldTrade.pl);
        
        return {
          ...acc,
          trades: acc.trades.map(t => t.id === tradeId ? { ...t, ...updatedData } : t),
          currentBalance: acc.currentBalance + balanceChange
        };
      }
      return acc;
    });
    setAccounts(updatedAccounts);
  };

  const deleteTrade = (tradeId) => {
    if (window.confirm('Delete this trade?')) {
      const updatedAccounts = accounts.map(acc => {
        if (acc.id === activeAccountId) {
          const trade = acc.trades.find(t => t.id === tradeId);
          return {
            ...acc,
            trades: acc.trades.filter(t => t.id !== tradeId),
            currentBalance: acc.currentBalance - parseFloat(trade.pl)
          };
        }
        return acc;
      });
      setAccounts(updatedAccounts);
    }
  };

  const bgClass = theme === 'dark' ? 'bg-gray-900' : 'bg-gray-50';
  const cardBgClass = theme === 'dark' ? 'bg-gray-800' : 'bg-white';
  const textClass = theme === 'dark' ? 'text-gray-100' : 'text-gray-900';
  const textSecondaryClass = theme === 'dark' ? 'text-gray-400' : 'text-gray-600';
  const borderClass = theme === 'dark' ? 'border-gray-700' : 'border-gray-200';

  if (accounts.length === 0 || !activeAccount) {
    return <WelcomeScreen theme={theme} toggleTheme={toggleTheme} onAddAccount={addAccount} />;
  }

  return (
    <div className={`min-h-screen ${bgClass} ${textClass}`}>
      {/* Header */}
      <header className={`${cardBgClass} border-b ${borderClass} sticky top-0 z-50`}>
        <div className="max-w-7xl mx-auto px-4 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-4">
              <div className="flex items-center space-x-2">
                <TrendingUp className="w-8 h-8 text-blue-500" />
                <h1 className="text-2xl font-bold">Nixie's Trading Journal</h1>
              </div>
            </div>
            
            <div className="flex items-center space-x-4">
              <select 
                value={activeAccountId}
                onChange={(e) => switchAccount(e.target.value)}
                className={`px-4 py-2 rounded-lg ${cardBgClass} border ${borderClass} ${textClass}`}
              >
                {accounts.map(acc => (
                  <option key={acc.id} value={acc.id}>{acc.name}</option>
                ))}
              </select>
              
              <button
                onClick={toggleTheme}
                className={`p-2 rounded-lg ${cardBgClass} border ${borderClass} hover:bg-opacity-80`}
              >
                {theme === 'dark' ? <Sun className="w-5 h-5" /> : <Moon className="w-5 h-5" />}
              </button>

              <button
                onClick={() => setShowAddAccount(true)}
                className="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
              >
                <PlusCircle className="w-5 h-5" />
              </button>
            </div>
          </div>
        </div>
      </header>

      {/* Navigation */}
      <nav className={`${cardBgClass} border-b ${borderClass}`}>
        <div className="max-w-7xl mx-auto px-4">
          <div className="flex space-x-1">
            {[
              { id: 'dashboard', label: 'Dashboard', icon: Home },
              { id: 'add', label: 'Add Trade', icon: PlusCircle },
              { id: 'history', label: 'Trade History', icon: BookOpen },
              { id: 'analytics', label: 'Analytics', icon: BarChart3 },
              { id: 'accounts', label: 'Accounts', icon: User }
            ].map(({ id, label, icon: Icon }) => (
              <button
                key={id}
                onClick={() => setCurrentView(id)}
                className={`px-4 py-3 flex items-center space-x-2 border-b-2 transition-colors ${
                  currentView === id
                    ? 'border-blue-500 text-blue-500'
                    : `border-transparent ${textSecondaryClass} hover:text-blue-400`
                }`}
              >
                <Icon className="w-5 h-5" />
                <span className="font-medium">{label}</span>
              </button>
            ))}
          </div>
        </div>
      </nav>

      {/* Main Content */}
      <main className="max-w-7xl mx-auto px-4 py-8">
        {currentView === 'dashboard' && <Dashboard account={activeAccount} theme={theme} />}
        {currentView === 'add' && <AddTrade onAddTrade={addTrade} theme={theme} />}
        {currentView === 'history' && <TradeHistory trades={activeAccount.trades} onUpdate={updateTrade} onDelete={deleteTrade} theme={theme} />}
        {currentView === 'analytics' && <Analytics account={activeAccount} theme={theme} />}
        {currentView === 'accounts' && <AccountsManager accounts={accounts} activeAccountId={activeAccountId} onSwitch={switchAccount} onDelete={deleteAccount} onAdd={() => setShowAddAccount(true)} theme={theme} />}
      </main>

      {/* Add Account Modal */}
      {showAddAccount && (
        <AddAccountModal 
          onClose={() => setShowAddAccount(false)} 
          onAdd={addAccount} 
          theme={theme} 
        />
      )}
    </div>
  );
};

const WelcomeScreen = ({ theme, toggleTheme, onAddAccount }) => {
  const [name, setName] = useState('');
  const [balance, setBalance] = useState('');
  const [broker, setBroker] = useState('Exness');

  const bgClass = theme === 'dark' ? 'bg-gray-900' : 'bg-gray-50';
  const cardBgClass = theme === 'dark' ? 'bg-gray-800' : 'bg-white';
  const textClass = theme === 'dark' ? 'text-gray-100' : 'text-gray-900';

  const handleSubmit = (e) => {
    e.preventDefault();
    if (name && balance) {
      onAddAccount(name, balance, broker);
    }
  };

  return (
    <div className={`min-h-screen ${bgClass} ${textClass} flex items-center justify-center p-4`}>
      <div className="absolute top-4 right-4">
        <button onClick={toggleTheme} className={`p-2 rounded-lg ${cardBgClass}`}>
          {theme === 'dark' ? <Sun className="w-5 h-5" /> : <Moon className="w-5 h-5" />}
        </button>
      </div>

      <div className={`${cardBgClass} rounded-2xl shadow-2xl p-8 max-w-md w-full`}>
        <div className="text-center mb-8">
          <TrendingUp className="w-16 h-16 text-blue-500 mx-auto mb-4" />
          <h1 className="text-3xl font-bold mb-2">Welcome to Nixie's Trading Journal</h1>
          <p className="text-gray-500">Track your trading journey with precision</p>
        </div>

        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium mb-2">Account Name</label>
            <input
              type="text"
              value={name}
              onChange={(e) => setName(e.target.value)}
              placeholder="My Trading Account"
              className={`w-full px-4 py-2 rounded-lg border ${theme === 'dark' ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Initial Balance</label>
            <input
              type="number"
              value={balance}
              onChange={(e) => setBalance(e.target.value)}
              placeholder="10000"
              step="0.01"
              className={`w-full px-4 py-2 rounded-lg border ${theme === 'dark' ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Broker</label>
            <select
              value={broker}
              onChange={(e) => setBroker(e.target.value)}
              className={`w-full px-4 py-2 rounded-lg border ${theme === 'dark' ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
            >
              <option>Exness</option>
              <option>IC Markets</option>
              <option>Pepperstone</option>
              <option>FTMO</option>
              <option>Other</option>
            </select>
          </div>

          <button
            type="submit"
            className="w-full py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700"
          >
            Create Account
          </button>
        </form>
      </div>
    </div>
  );
};

const Dashboard = ({ account, theme }) => {
  const cardBgClass = theme === 'dark' ? 'bg-gray-800' : 'bg-white';
  const borderClass = theme === 'dark' ? 'border-gray-700' : 'border-gray-200';

  const stats = calculateStats(account.trades, account.initialBalance, account.currentBalance);

  return (
    <div className="space-y-6">
      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <StatCard
          title="Current Balance"
          value={`$${account.currentBalance.toFixed(2)}`}
          change={stats.totalPL}
          icon={DollarSign}
          theme={theme}
        />
        <StatCard
          title="Total Trades"
          value={account.trades.length}
          subtitle={`${stats.winningTrades} wins, ${stats.losingTrades} losses`}
          icon={Activity}
          theme={theme}
        />
        <StatCard
          title="Win Rate"
          value={`${stats.winRate}%`}
          subtitle={`Profit Factor: ${stats.profitFactor}`}
          icon={PieChart}
          theme={theme}
        />
        <StatCard
          title="Avg R:R"
          value={stats.avgRR}
          subtitle={`Best: ${stats.bestTrade}`}
          icon={TrendingUp}
          theme={theme}
        />
      </div>

      {/* Charts Section */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div className={`${cardBgClass} rounded-lg p-6 border ${borderClass}`}>
          <h3 className="text-lg font-semibold mb-4">Equity Curve</h3>
          <EquityCurve trades={account.trades} initialBalance={account.initialBalance} theme={theme} />
        </div>

        <div className={`${cardBgClass} rounded-lg p-6 border ${borderClass}`}>
          <h3 className="text-lg font-semibold mb-4">Recent Trades</h3>
          <RecentTrades trades={account.trades.slice(-5).reverse()} theme={theme} />
        </div>
      </div>

      {/* Performance Breakdown */}
      <div className={`${cardBgClass} rounded-lg p-6 border ${borderClass}`}>
        <h3 className="text-lg font-semibold mb-4">Performance Breakdown</h3>
        <PerformanceBreakdown trades={account.trades} theme={theme} />
      </div>
    </div>
  );
};

const StatCard = ({ title, value, change, subtitle, icon: Icon, theme }) => {
  const cardBgClass = theme === 'dark' ? 'bg-gray-800' : 'bg-white';
  const borderClass = theme === 'dark' ? 'border-gray-700' : 'border-gray-200';

  return (
    <div className={`${cardBgClass} rounded-lg p-6 border ${borderClass}`}>
      <div className="flex items-center justify-between mb-2">
        <p className="text-sm text-gray-500">{title}</p>
        <Icon className="w-5 h-5 text-blue-500" />
      </div>
      <p className="text-2xl font-bold">{value}</p>
      {change !== undefined && (
        <p className={`text-sm mt-1 ${change >= 0 ? 'text-green-500' : 'text-red-500'}`}>
          {change >= 0 ? '+' : ''}{change.toFixed(2)}%
        </p>
      )}
      {subtitle && <p className="text-sm text-gray-500 mt-1">{subtitle}</p>}
    </div>
  );
};

const AddTrade = ({ onAddTrade, theme }) => {
  const [formData, setFormData] = useState({
    date: new Date().toISOString().split('T')[0],
    entryTime: new Date().toTimeString().slice(0, 5),
    exitTime: '',
    symbol: 'EURUSD',
    direction: 'long',
    entryPrice: '',
    exitPrice: '',
    stopLoss: '',
    takeProfit: '',
    lotSize: '',
    pl: '',
    setup: '',
    emotionalState: 'calm',
    notes: ''
  });

  const cardBgClass = theme === 'dark' ? 'bg-gray-800' : 'bg-white';
  const borderClass = theme === 'dark' ? 'border-gray-700' : 'border-gray-200';
  const inputClass = theme === 'dark' ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300';

  const calculatePL = () => {
    const { symbol, direction, entryPrice, exitPrice, lotSize } = formData;
    if (!entryPrice || !exitPrice || !lotSize) return;

    const entry = parseFloat(entryPrice);
    const exit = parseFloat(exitPrice);
    const lot = parseFloat(lotSize);

    const config = SYMBOL_CONFIGS[symbol] || { pipValue: 0.0001, pipPosition: 4 };
    const pipDiff = direction === 'long' ? (exit - entry) / config.pipValue : (entry - exit) / config.pipValue;
    
    // Standard lot = 100,000 units
    const contractSize = 100000;
    const pl = pipDiff * config.pipValue * lot * contractSize;

    setFormData({ ...formData, pl: pl.toFixed(2) });
  };

  useEffect(() => {
    calculatePL();
  }, [formData.entryPrice, formData.exitPrice, formData.lotSize, formData.direction]);

  const handleSubmit = (e) => {
    e.preventDefault();
    onAddTrade(formData);
    setFormData({
      date: new Date().toISOString().split('T')[0],
      entryTime: new Date().toTimeString().slice(0, 5),
      exitTime: '',
      symbol: 'EURUSD',
      direction: 'long',
      entryPrice: '',
      exitPrice: '',
      stopLoss: '',
      takeProfit: '',
      lotSize: '',
      pl: '',
      setup: '',
      emotionalState: 'calm',
      notes: ''
    });
  };

  return (
    <div className={`${cardBgClass} rounded-lg p-6 border ${borderClass} max-w-4xl mx-auto`}>
      <h2 className="text-2xl font-bold mb-6">Add New Trade</h2>
      
      <form onSubmit={handleSubmit} className="space-y-6">
        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium mb-2">Date</label>
            <input
              type="date"
              value={formData.date}
              onChange={(e) => setFormData({ ...formData, date: e.target.value })}
              className={`w-full px-4 py-2 rounded-lg border ${inputClass}`}
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Symbol</label>
            <select
              value={formData.symbol}
              onChange={(e) => setFormData({ ...formData, symbol: e.target.value })}
              className={`w-full px-4 py-2 rounded-lg border ${inputClass}`}
            >
              <optgroup label="Forex Majors">
                <option value="EURUSD">EUR/USD</option>
                <option value="GBPUSD">GBP/USD</option>
                <option value="USDJPY">USD/JPY</option>
                <option value="USDCHF">USD/CHF</option>
                <option value="AUDUSD">AUD/USD</option>
                <option value="USDCAD">USD/CAD</option>
                <option value="NZDUSD">NZD/USD</option>
              </optgroup>
              <optgroup label="Metals">
                <option value="XAUUSD">Gold (XAU/USD)</option>
                <option value="XAGUSD">Silver (XAG/USD)</option>
              </optgroup>
              <optgroup label="Crypto">
                <option value="BTCUSD">Bitcoin</option>
                <option value="ETHUSD">Ethereum</option>
              </optgroup>
              <optgroup label="Indices">
                <option value="US30">US30</option>
                <option value="US100">US100</option>
                <option value="US500">US500</option>
              </optgroup>
            </select>
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Entry Time</label>
            <input
              type="time"
              value={formData.entryTime}
              onChange={(e) => setFormData({ ...formData, entryTime: e.target.value })}
              className={`w-full px-4 py-2 rounded-lg border ${inputClass}`}
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Exit Time</label>
            <input
              type="time"
              value={formData.exitTime}
              onChange={(e) => setFormData({ ...formData, exitTime: e.target.value })}
              className={`w-full px-4 py-2 rounded-lg border ${inputClass}`}
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Direction</label>
            <select
              value={formData.direction}
              onChange={(e) => setFormData({ ...formData, direction: e.target.value })}
              className={`w-full px-4 py-2 rounded-lg border ${inputClass}`}
            >
              <option value="long">Long</option>
              <option value="short">Short</option>
            </select>
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Lot Size</label>
            <input
              type="number"
              step="0.01"
              value={formData.lotSize}
              onChange={(e) => setFormData({ ...formData, lotSize: e.target.value })}
              className={`w-full px-4 py-2 rounded-lg border ${inputClass}`}
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Entry Price</label>
            <input
              type="number"
              step="0.00001"
              value={formData.entryPrice}
              onChange={(e) => setFormData({ ...formData, entryPrice: e.target.value })}
              className={`w-full px-4 py-2 rounded-lg border ${inputClass}`}
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Exit Price</label>
            <input
              type="number"
              step="0.00001"
              value={formData.exitPrice}
              onChange={(e) => setFormData({ ...formData, exitPrice: e.target.value })}
              className={`w-full px-4 py-2 rounded-lg border ${inputClass}`}
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Stop Loss</label>
            <input
              type="number"
              step="0.00001"
              value={formData.stopLoss}
              onChange={(e) => setFormData({ ...formData, stopLoss: e.target.value })}
              className={`w-full px-4 py-2 rounded-lg border ${inputClass}`}
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Take Profit</label>
            <input
              type="number"
              step="0.00001"
              value={formData.takeProfit}
              onChange={(e) => setFormData({ ...formData, takeProfit: e.target.value })}
              className={`w-full px-4 py-2 rounded-lg border ${inputClass}`}
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">P/L (Auto-calculated)</label>
            <input
              type="number"
              step="0.01"
              value={formData.pl}
              onChange={(e) => setFormData({ ...formData, pl: e.target.value })}
              className={`w-full px-4 py-2 rounded-lg border ${inputClass}`}
              required
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Emotional State</label>
            <select
              value={formData.emotionalState}
              onChange={(e) => setFormData({ ...formData, emotionalState: e.target.value })}
              className={`w-full px-4 py-2 rounded-lg border ${inputClass}`}
            >
              <option value="calm">Calm & Focused</option>
              <option value="confident">Confident</option>
              <option value="anxious">Anxious</option>
              <option value="revenge">Revenge Trading</option>
              <option value="fomo">FOMO</option>
            </select>
          </div>
        </div>

        <div>
          <label className="block text-sm font-medium mb-2">Setup/Strategy</label>
          <input
            type="text"
            value={formData.setup}
            onChange={(e) => setFormData({ ...formData, setup: e.target.value })}
            placeholder="e.g., FVG + Order Block, Trend Following, etc."
            className={`w-full px-4 py-2 rounded-lg border ${inputClass}`}
          />
        </div>

        <div>
          <label className="block text-sm font-medium mb-2">Trade Notes</label>
          <textarea
            value={formData.notes}
            onChange={(e) => setFormData({ ...formData, notes: e.target.value })}
            placeholder="What went well? What could be improved?"
            rows="4"
            className={`w-full px-4 py-2 rounded-lg border ${inputClass}`}
          />
        </div>

        <button
          type="submit"
          className="w-full py-3 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700"
        >
          Add Trade
        </button>
      </form>
    </div>
  );
};

const TradeHistory = ({ trades, onUpdate, onDelete, theme }) => {
  const [editingId, setEditingId] = useState(null);
  const [editData, setEditData] = useState({});
  const [filter, setFilter] = useState('all');

  const cardBgClass = theme === 'dark' ? 'bg-gray-800' : 'bg-white';
  const borderClass = theme === 'dark' ? 'border-gray-700' : 'border-gray-200';

  const exportToCSV = () => {
    const headers = ['Date', 'Symbol', 'Direction', 'Entry Price', 'Exit Price', 'Lot Size', 'P/L', 'Setup', 'Emotional State', 'Notes'];
    const rows = trades.map(t => [
      t.date,
      t.symbol,
      t.direction,
      t.entryPrice,
      t.exitPrice,
      t.lotSize,
      t.pl,
      t.setup,
      t.emotionalState,
      t.notes
    ]);

    const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `trades_${new Date().toISOString().split('T')[0]}.csv`;
    a.click();
  };

  const startEdit = (trade) => {
    setEditingId(trade.id);
    setEditData(trade);
  };

  const saveEdit = () => {
    onUpdate(editingId, editData);
    setEditingId(null);
    setEditData({});
  };

  const filteredTrades = trades.filter(t => {
    if (filter === 'all') return true;
    if (filter === 'wins') return parseFloat(t.pl) > 0;
    if (filter === 'losses') return parseFloat(t.pl) < 0;
    return true;
  });

  return (
    <div className="space-y-4">
      <div className="flex justify-between items-center">
        <div className="flex space-x-2">
          {['all', 'wins', 'losses'].map(f => (
            <button
              key={f}
              onClick={() => setFilter(f)}
              className={`px-4 py-2 rounded-lg ${filter === f ? 'bg-blue-600 text-white' : `${cardBgClass} border ${borderClass}`}`}
            >
              {f.charAt(0).toUpperCase() + f.slice(1)}
            </button>
          ))}
        </div>
        <button
          onClick={exportToCSV}
          className="flex items-center space-x-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
        >
          <Download className="w-5 h-5" />
          <span>Export CSV</span>
        </button>
      </div>

      <div className={`${cardBgClass} rounded-lg border ${borderClass} overflow-hidden`}>
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className={`${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-100'}`}>
              <tr>
                <th className="px-4 py-3 text-left text-sm font-medium">Date</th>
                <th className="px-4 py-3 text-left text-sm font-medium">Symbol</th>
                <th className="px-4 py-3 text-left text-sm font-medium">Direction</th>
                <th className="px-4 py-3 text-left text-sm font-medium">Entry</th>
                <th className="px-4 py-3 text-left text-sm font-medium">Exit</th>
                <th className="px-4 py-3 text-left text-sm font-medium">P/L</th>
                <th className="px-4 py-3 text-left text-sm font-medium">Setup</th>
                <th className="px-4 py-3 text-left text-sm font-medium">Actions</th>
              </tr>
            </thead>
            <tbody>
              {filteredTrades.map(trade => (
                <tr key={trade.id} className={`border-t ${borderClass}`}>
                  {editingId === trade.id ? (
                    <>
                      <td className="px-4 py-3">
                        <input
                          type="date"
                          value={editData.date}
                          onChange={(e) => setEditData({ ...editData, date: e.target.value })}
                          className={`w-full px-2 py-1 rounded ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-100'}`}
                        />
                      </td>
                      <td className="px-4 py-3">{trade.symbol}</td>
                      <td className="px-4 py-3">{trade.direction}</td>
                      <td className="px-4 py-3">
                        <input
                          type="number"
                          step="0.00001"
                          value={editData.entryPrice}
                          onChange={(e) => setEditData({ ...editData, entryPrice: e.target.value })}
                          className={`w-20 px-2 py-1 rounded ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-100'}`}
                        />
                      </td>
                      <td className="px-4 py-3">
                        <input
                          type="number"
                          step="0.00001"
                          value={editData.exitPrice}
                          onChange={(e) => setEditData({ ...editData, exitPrice: e.target.value })}
                          className={`w-20 px-2 py-1 rounded ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-100'}`}
                        />
                      </td>
                      <td className="px-4 py-3">
                        <input
                          type="number"
                          step="0.01"
                          value={editData.pl}
                          onChange={(e) => setEditData({ ...editData, pl: e.target.value })}
                          className={`w-24 px-2 py-1 rounded ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-100'}`}
                        />
                      </td>
                      <td className="px-4 py-3">
                        <input
                          type="text"
                          value={editData.setup}
                          onChange={(e) => setEditData({ ...editData, setup: e.target.value })}
                          className={`w-full px-2 py-1 rounded ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-100'}`}
                        />
                      </td>
                      <td className="px-4 py-3">
                        <button
                          onClick={saveEdit}
                          className="text-green-500 hover:text-green-600 mr-2"
                        >
                          Save
                        </button>
                        <button
                          onClick={() => setEditingId(null)}
                          className="text-gray-500 hover:text-gray-600"
                        >
                          Cancel
                        </button>
                      </td>
                    </>
                  ) : (
                    <>
                      <td className="px-4 py-3">{trade.date}</td>
                      <td className="px-4 py-3">{trade.symbol}</td>
                      <td className="px-4 py-3">
                        <span className={`px-2 py-1 rounded text-xs ${trade.direction === 'long' ? 'bg-green-500' : 'bg-red-500'} text-white`}>
                          {trade.direction.toUpperCase()}
                        </span>
                      </td>
                      <td className="px-4 py-3">{parseFloat(trade.entryPrice).toFixed(5)}</td>
                      <td className="px-4 py-3">{parseFloat(trade.exitPrice).toFixed(5)}</td>
                      <td className="px-4 py-3">
                        <span className={`font-semibold ${parseFloat(trade.pl) >= 0 ? 'text-green-500' : 'text-red-500'}`}>
                          ${parseFloat(trade.pl).toFixed(2)}
                        </span>
                      </td>
                      <td className="px-4 py-3">{trade.setup}</td>
                      <td className="px-4 py-3">
                        <button
                          onClick={() => startEdit(trade)}
                          className="text-blue-500 hover:text-blue-600 mr-2"
                        >
                          <Edit2 className="w-4 h-4" />
                        </button>
                        <button
                          onClick={() => onDelete(trade.id)}
                          className="text-red-500 hover:text-red-600"
                        >
                          <Trash2 className="w-4 h-4" />
                        </button>
                      </td>
                    </>
                  )}
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
};

const Analytics = ({ account, theme }) => {
  const cardBgClass = theme === 'dark' ? 'bg-gray-800' : 'bg-white';
  const borderClass = theme === 'dark' ? 'border-gray-700' : 'border-gray-200';

  const stats = calculateStats(account.trades, account.initialBalance, account.currentBalance);
  const emotionalAnalysis = analyzeEmotionalStates(account.trades);
  const setupPerformance = analyzeSetups(account.trades);

  return (
    <div className="space-y-6">
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div className={`${cardBgClass} rounded-lg p-6 border ${borderClass}`}>
          <h3 className="text-lg font-semibold mb-4">Emotional State Analysis</h3>
          <div className="space-y-3">
            {Object.entries(emotionalAnalysis).map(([state, data]) => (
              <div key={state}>
                <div className="flex justify-between text-sm mb-1">
                  <span className="capitalize">{state.replace('_', ' & ')}</span>
                  <span>{data.count} trades ({data.winRate}% WR)</span>
                </div>
                <div className="w-full bg-gray-700 rounded-full h-2">
                  <div
                    className="bg-blue-500 h-2 rounded-full"
                    style={{ width: `${data.winRate}%` }}
                  />
                </div>
              </div>
            ))}
          </div>
        </div>

        <div className={`${cardBgClass} rounded-lg p-6 border ${borderClass}`}>
          <h3 className="text-lg font-semibold mb-4">Setup Performance</h3>
          <div className="space-y-3">
            {Object.entries(setupPerformance).slice(0, 5).map(([setup, data]) => (
              <div key={setup}>
                <div className="flex justify-between text-sm mb-1">
                  <span>{setup || 'No Setup'}</span>
                  <span>${data.totalPL.toFixed(2)}</span>
                </div>
                <div className="text-xs text-gray-500">
                  {data.count} trades • {data.winRate}% WR
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>

      <div className={`${cardBgClass} rounded-lg p-6 border ${borderClass}`}>
        <h3 className="text-lg font-semibold mb-4">Monthly Performance</h3>
        <MonthlyPerformance trades={account.trades} theme={theme} />
      </div>
    </div>
  );
};

const AccountsManager = ({ accounts, activeAccountId, onSwitch, onDelete, onAdd, theme }) => {
  const cardBgClass = theme === 'dark' ? 'bg-gray-800' : 'bg-white';
  const borderClass = theme === 'dark' ? 'border-gray-700' : 'border-gray-200';

  return (
    <div className="space-y-4">
      <div className="flex justify-between items-center">
        <h2 className="text-2xl font-bold">Manage Accounts</h2>
        <button
          onClick={onAdd}
          className="flex items-center space-x-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
        >
          <PlusCircle className="w-5 h-5" />
          <span>Add Account</span>
        </button>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {accounts.map(account => {
          const stats = calculateStats(account.trades, account.initialBalance, account.currentBalance);
          return (
            <div
              key={account.id}
              className={`${cardBgClass} rounded-lg p-6 border ${borderClass} ${account.id === activeAccountId ? 'ring-2 ring-blue-500' : ''}`}
            >
              <div className="flex justify-between items-start mb-4">
                <div>
                  <h3 className="text-lg font-semibold">{account.name}</h3>
                  <p className="text-sm text-gray-500">{account.broker}</p>
                </div>
                {account.id === activeAccountId && (
                  <span className="px-2 py-1 bg-blue-500 text-white text-xs rounded">Active</span>
                )}
              </div>

              <div className="space-y-2 mb-4">
                <div className="flex justify-between">
                  <span className="text-sm text-gray-500">Balance:</span>
                  <span className="font-semibold">${account.currentBalance.toFixed(2)}</span>
                </div>
                <div className="flex justify-between">
                  <span className="text-sm text-gray-500">Trades:</span>
                  <span>{account.trades.length}</span>
                </div>
                <div className="flex justify-between">
                  <span className="text-sm text-gray-500">Win Rate:</span>
                  <span>{stats.winRate}%</span>
                </div>
              </div>

              <div className="flex space-x-2">
                <button
                  onClick={() => onSwitch(account.id)}
                  className="flex-1 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                  disabled={account.id === activeAccountId}
                >
                  {account.id === activeAccountId ? 'Active' : 'Switch'}
                </button>
                <button
                  onClick={() => onDelete(account.id)}
                  className="px-3 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700"
                >
                  <Trash2 className="w-4 h-4" />
                </button>
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
};

const AddAccountModal = ({ onClose, onAdd, theme }) => {
  const [name, setName] = useState('');
  const [balance, setBalance] = useState('');
  const [broker, setBroker] = useState('Exness');

  const handleSubmit = (e) => {
    e.preventDefault();
    if (name && balance) {
      onAdd(name, balance, broker);
    }
  };

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className={`${theme === 'dark' ? 'bg-gray-800' : 'bg-white'} rounded-lg p-6 max-w-md w-full`}>
        <h2 className="text-2xl font-bold mb-4">Add New Account</h2>
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium mb-2">Account Name</label>
            <input
              type="text"
              value={name}
              onChange={(e) => setName(e.target.value)}
              className={`w-full px-4 py-2 rounded-lg border ${theme === 'dark' ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
              required
            />
          </div>
          <div>
            <label className="block text-sm font-medium mb-2">Initial Balance</label>
            <input
              type="number"
              step="0.01"
              value={balance}
              onChange={(e) => setBalance(e.target.value)}
              className={`w-full px-4 py-2 rounded-lg border ${theme === 'dark' ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
              required
            />
          </div>
          <div>
            <label className="block text-sm font-medium mb-2">Broker</label>
            <select
              value={broker}
              onChange={(e) => setBroker(e.target.value)}
              className={`w-full px-4 py-2 rounded-lg border ${theme === 'dark' ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-300'}`}
            >
              <option>Exness</option>
              <option>IC Markets</option>
              <option>Pepperstone</option>
              <option>FTMO</option>
              <option>Other</option>
            </select>
          </div>
          <div className="flex space-x-2">
            <button type="submit" className="flex-1 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
              Create Account
            </button>
            <button type="button" onClick={onClose} className="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  );
};

// Helper Components
const EquityCurve = ({ trades, initialBalance, theme }) => {
  const sortedTrades = [...trades].sort((a, b) => new Date(a.date) - new Date(b.date));
  let balance = initialBalance;
  const data = [{ date: 'Start', balance: initialBalance }];
  
  sortedTrades.forEach(trade => {
    balance += parseFloat(trade.pl);
    data.push({ date: trade.date, balance });
  });

  const maxBalance = Math.max(...data.map(d => d.balance));
  const minBalance = Math.min(...data.map(d => d.balance));
  const range = maxBalance - minBalance;

  return (
    <div className="h-48 flex items-end space-x-1">
      {data.map((point, i) => {
        const height = ((point.balance - minBalance) / range) * 100;
        return (
          <div
            key={i}
            className="flex-1 bg-blue-500 rounded-t"
            style={{ height: `${height}%` }}
            title={`${point.balance.toFixed(2)}`}
          />
        );
      })}
    </div>
  );
};

const RecentTrades = ({ trades, theme }) => {
  if (trades.length === 0) {
    return <p className="text-gray-500 text-center py-8">No trades yet</p>;
  }

  return (
    <div className="space-y-2">
      {trades.map(trade => (
        <div key={trade.id} className={`flex justify-between items-center p-3 rounded-lg ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-100'}`}>
          <div>
            <p className="font-medium">{trade.symbol}</p>
            <p className="text-sm text-gray-500">{trade.date}</p>
          </div>
          <div className="text-right">
            <p className={`font-semibold ${parseFloat(trade.pl) >= 0 ? 'text-green-500' : 'text-red-500'}`}>
              ${parseFloat(trade.pl).toFixed(2)}
            </p>
            <span className={`text-xs px-2 py-1 rounded ${trade.direction === 'long' ? 'bg-green-500' : 'bg-red-500'} text-white`}>
              {trade.direction.toUpperCase()}
            </span>
          </div>
        </div>
      ))}
    </div>
  );
};

const PerformanceBreakdown = ({ trades, theme }) => {
  const bySymbol = {};
  trades.forEach(trade => {
    if (!bySymbol[trade.symbol]) {
      bySymbol[trade.symbol] = { wins: 0, losses: 0, total: 0 };
    }
    bySymbol[trade.symbol].total += parseFloat(trade.pl);
    if (parseFloat(trade.pl) > 0) bySymbol[trade.symbol].wins++;
    else bySymbol[trade.symbol].losses++;
  });

  return (
    <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
      {Object.entries(bySymbol).map(([symbol, data]) => (
        <div key={symbol} className={`p-4 rounded-lg ${theme === 'dark' ? 'bg-gray-700' : 'bg-gray-100'}`}>
          <p className="font-medium">{symbol}</p>
          <p className={`text-lg font-bold ${data.total >= 0 ? 'text-green-500' : 'text-red-500'}`}>
            ${data.total.toFixed(2)}
          </p>
          <p className="text-sm text-gray-500">{data.wins}W / {data.losses}L</p>
        </div>
      ))}
    </div>
  );
};

const MonthlyPerformance = ({ trades, theme }) => {
  const byMonth = {};
  trades.forEach(trade => {
    const month = trade.date.substring(0, 7);
    if (!byMonth[month]) byMonth[month] = 0;
    byMonth[month] += parseFloat(trade.pl);
  });

  return (
    <div className="space-y-2">
      {Object.entries(byMonth).reverse().map(([month, pl]) => (
        <div key={month} className="flex justify-between items-center">
          <span>{month}</span>
          <span className={`font-semibold ${pl >= 0 ? 'text-green-500' : 'text-red-500'}`}>
            ${pl.toFixed(2)}
          </span>
        </div>
      ))}
    </div>
  );
};

// Calculation Functions
function calculateStats(trades, initialBalance, currentBalance) {
  if (trades.length === 0) {
    return {
      totalPL: 0,
      winningTrades: 0,
      losingTrades: 0,
      winRate: 0,
      profitFactor: 0,
      avgRR: '0:0',
      bestTrade: '$0.00'
    };
  }

  const winningTrades = trades.filter(t => parseFloat(t.pl) > 0);
  const losingTrades = trades.filter(t => parseFloat(t.pl) < 0);
  
  const totalWins = winningTrades.reduce((sum, t) => sum + parseFloat(t.pl), 0);
  const totalLosses = Math.abs(losingTrades.reduce((sum, t) => sum + parseFloat(t.pl), 0));
  
  const profitFactor = totalLosses > 0 ? (totalWins / totalLosses).toFixed(2) : totalWins > 0 ? '∞' : '0';
  const winRate = ((winningTrades.length / trades.length) * 100).toFixed(1);
  
  const totalPL = ((currentBalance - initialBalance) / initialBalance) * 100;
  
  const bestTrade = trades.reduce((max, t) => parseFloat(t.pl) > parseFloat(max.pl) ? t : max, trades[0]);
  
  return {
    totalPL,
    winningTrades: winningTrades.length,
    losingTrades: losingTrades.length,
    winRate,
    profitFactor,
    avgRR: '1:3',
    bestTrade: `${parseFloat(bestTrade.pl).toFixed(2)}`
  };
}

function analyzeEmotionalStates(trades) {
  const states = {};
  trades.forEach(trade => {
    if (!states[trade.emotionalState]) {
      states[trade.emotionalState] = { count: 0, wins: 0 };
    }
    states[trade.emotionalState].count++;
    if (parseFloat(trade.pl) > 0) states[trade.emotionalState].wins++;
  });

  Object.keys(states).forEach(key => {
    states[key].winRate = ((states[key].wins / states[key].count) * 100).toFixed(1);
  });

  return states;
}

function analyzeSetups(trades) {
  const setups = {};
  trades.forEach(trade => {
    const setup = trade.setup || 'No Setup';
    if (!setups[setup]) {
      setups[setup] = { count: 0, wins: 0, totalPL: 0 };
    }
    setups[setup].count++;
    setups[setup].totalPL += parseFloat(trade.pl);
    if (parseFloat(trade.pl) > 0) setups[setup].wins++;
  });

  Object.keys(setups).forEach(key => {
    setups[key].winRate = ((setups[key].wins / setups[key].count) * 100).toFixed(1);
  });

  return setups;
}

export default TradingJournal;
        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TradingJournal />);
    </script>
</body>
</html>